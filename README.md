# ILINE-Group
Тестовое задание

## Задача:
Написать скрипт, который позволит определенные логи событий из срм системы "amo crm" загружать в гугл таблицу, а именно в динамические ячейки гугл таблиц.
Например, Логи кластера №1 сегодня в ячейку А1, а завтра Логи этого же кластера отправляем в ячейку А2 и тд.

## Вариант решения:

Для подключения к гугл-таблицам, создания новой таблицы и её наполнения использован Google Sheets API v4.

В Google Cluod был создан проект, подключены для этого проекта API: Drive API и Sheets API.

В проекте был создан сервисный аккаунт и для него был добавлен ключ (тип ключа JSON).

JSON файл (скачен при создании ключа и хранится в папке с кодом), который необходим для создания сервис-объекта для работы с гугл таблицами.
(Service Accounts - Manage keys - Add key - JSON).

## Requirements
google-api-python-client

python-dotenv

## main.py 
1. Класс Tables, имеет метод создания новой гугл-таблицы, метод записи данных в таблицу из файла, метод получения URL таблицы.
2. Имя файла (либо путь/имя) с логами необходимо указать в файле .env в переменной LOG_FILE.
3. При выполнении main.py будет предложено создать новую таблицу, если необходимо.
Если новую таблицу не создавать, данные будут записаны в существующую таблицу,
ID которой указано в переменной окружения SPREADSHEET_ID. ВАЖНО открыть доступ к данной таблице с ролью "Редактор".
4. Внутри класса Tables создан сервис-объект для подключения и работы с гугл-таблицами и предоставления доступа к ним (в случае создания новой таблицы).
5. Для создания подключения, в переменной окружения CREDENTIALS_FILE необходимо указать имя JSON файла,
скаченного при создании ключа сервисного аккаунта.
6. Добавление данных будет осуществлять последовательно с ячейки А1,
при каждом выполнении main.py данные будут записываться в следующую
пустую ячейку (А2, А3 и тд.).
7. После добавления данных будет отображена ссылка для просмотра гугл-таблицы.
8. 


## .env
Пример содержимого файла

CREDENTIALS_FILE = 'managesheet-371909-eeba38bd209f.json'  # пример имени файла с закрытым ключом, полученый при создании Сервисного аккаунта


SPREADSHEET_ID = '1hrFK9q3kxBjY20KjhKqLgRw8tOLJEZDSZYPQH4hOX8g'  # пример ID google таблицы, куда вносим данные


LOG_FILE = logs.log  # имя файла(либо путь/имя) с логами

### Пример вывода, при подключении к существующей таблице (если доступ к таблице ограничен):
    $ python main.py    
    Подключено к google-таблицам
    Создать новую таблицу? "Y/N?":n
    <HttpError 403 when requesting https://sheets.googleapis.com/v4/spreadsheets/1873IfuBOIQsvRbwLpmB9YTqrXwXOAGzjAM7yDHrU0UY/values/%D0%9B%D0%B8%D1%81%D1%821%21A1%3AA1:append?valueInputOption=USER_ENTERED&alt=json returned "The caller does not have permission". Details: "The caller does not have permission">
    403=Проверить, открыт ли доступ к таблице (режим "Редактор")
    404=Верно ли указан ID таблицы
    Не удалось внести данные


### Пример вывода, в случае создания новой таблицы:
    $ python main.py 
    Подключено к google-таблицам
    Создать новую таблицу? "Y/N?":y
    Enter table name: Rest
    Новая таблица создана, tableID= 1bfwyzwwOiy2QXfn1CRTNHFSU0Ya7ZbLeU80P4CjaqQI
    Данные внесены в таблицу, посмотреть таблицу по адресу: https://docs.google.com/spreadsheets/d/1bfwyzwwOiy2QXfn1CRTNHFSU0Ya7ZbLeU80P4CjaqQI/edit#gid=

### Пример вывода, при подключении к существующей таблицы и успешной отправки данных:
    $ python main.py     
    Подключено к google-таблицам
    Создать новую таблицу? "Y/N?":n
    Данные внесены в таблицу, посмотреть таблицу по адресу: https://docs.google.com/spreadsheets/d/1873IfuBOIQsvRbwLpmB9YTqrXwXOAGzjAM7yDHrU0UY/edit#gid=